<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ø±ÙÙŠÙ‚ Ø§Ù„Ù‚Ø±Ø¢Ù† - Ø±Ù…Ø¶Ø§Ù† 1447</title>
    <meta name="theme-color" content="#1e3c72">
    <style>
        :root {
            --primary: #1e3c72;
            --header-grad: linear-gradient(135deg, #1e3c72, #2a5298);
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --border-color: #e0e0e0;
            --status-current-bg: #e8f5e9;
            --status-current-border: #4caf50;
            --status-warn-bg: #fffde7;
            --status-warn-border: #fbc02d;
            --status-danger-bg: #ffebee;
            --status-danger-border: #e57373;
            --separator-color: #888;
        }
        [data-theme="dark"] {
            --primary: #64b5f6;
            --header-grad: linear-gradient(135deg, #0d1b2a, #1b263b);
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sub: #b0b0b0;
            --border-color: #333;
            --status-current-bg: #1b3a20;
            --status-current-border: #2e7d32;
            --status-warn-bg: #3e3818;
            --status-warn-border: #f9a825;
            --status-danger-bg: #3e1b1b;
            --status-danger-border: #c62828;
            --separator-color: #aaa;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--text-main); padding-bottom: 80px; }
        header { background: var(--header-grad); color: white; padding: 25px 15px; text-align: center; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-bottom: 25px; position: relative; z-index: 10; }
        .header-title { font-size: 1.5rem; margin: 0 0 10px 0; font-weight: 800; }
        .datetime { font-size: 0.9rem; opacity: 0.9; background: rgba(255,255,255,0.15); padding: 5px 12px; border-radius: 20px; display: inline-block; margin-top: 5px; }
        .header-icons { position: absolute; top: 20px; left: 20px; display: flex; gap: 10px; z-index: 20; }
        .icon-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 44px; height: 44px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .container { max-width: 600px; margin: 0 auto; padding: 0 15px; display: flex; flex-direction: column; gap: 20px; padding-left: 20px; }
        .summary-box { background: var(--card-bg); padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid var(--border-color); }
        .summary-number { font-size: 3.5rem; font-weight: 800; color: var(--primary); line-height: 1; margin: 10px 0; }
        .summary-label { color: var(--text-sub); font-size: 0.95rem; }
        .floating-tracker { position: fixed; left: 20px; top: 160px; z-index: 100; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        .tracker-bubble { background: var(--primary); color: white; width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 2px solid rgba(255,255,255,0.9); pointer-events: auto; }
        [data-theme="dark"] .tracker-bubble { border-color: #333; color: #121212; }
        .day-card { background: var(--card-bg); border-radius: 12px; overflow: hidden; border: 1px solid var(--border-color); margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .day-card.current { background-color: var(--status-current-bg); border: 2px solid var(--status-current-border); border-width: 2px; }
        .day-card.missed-yellow { background-color: var(--status-warn-bg); border: 2px solid var(--status-warn-border); }
        .day-card.missed-red { background-color: var(--status-danger-bg); border: 2px solid var(--status-danger-border); }
        .card-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .date-group { display: flex; flex-direction: column; gap: 4px; }
        .day-name { font-weight: 700; font-size: 1.1rem; color: var(--text-main); }
        .day-date { font-size: 0.85rem; color: var(--text-sub); }
        .status-badge { font-size: 0.9rem; font-weight: bold; background: rgba(0,0,0,0.05); padding: 4px 10px; border-radius: 12px; min-width: 60px; text-align: center; }
        [data-theme="dark"] .status-badge { background: rgba(255,255,255,0.1); }
        .card-body { max-height: 0; overflow: hidden; transition: max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1); background: rgba(127, 127, 127, 0.03); }
        .card-body.open { max-height: 800px; border-top: 1px solid var(--border-color); }
        .prayer-list { padding: 15px 20px; }
        .prayer-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); gap: 10px; }
        .prayer-item:last-child { border-bottom: none; }
        .custom-checkbox { width: 24px; height: 24px; accent-color: var(--primary); cursor: pointer; }
        .prayer-label { font-size: 1rem; flex: 1; color: var(--text-main); display: flex; flex-direction: column; }
        .page-range { font-size: 0.85rem; color: var(--text-sub); margin-top: 2px; }
        .read-btn { background-color: #27ae60; color: white; border: none; border-radius: 8px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.1rem; flex-shrink: 0; text-decoration: none; }
        .read-btn:hover { transform: scale(1.1); background-color: #219150; }
        .complete-btn { width: calc(100% - 40px); margin: 0 20px 20px 20px; padding: 14px; background-color: var(--primary); color: var(--bg); border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .complete-btn.done { background-color: #27ae60; color: white; pointer-events: none; }
        [data-theme="dark"] .complete-btn { color: #000; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 5000; align-items: center; justify-content: center; flex-direction: column; }
        .settings-container { background: var(--card-bg); width: 90%; max-width: 400px; padding: 20px; border-radius: 15px; color: var(--text-main); text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .settings-row { margin: 15px 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        .external-btn { background: #d4ac0d; color: #000; border: none; padding: 5px 15px; border-radius: 5px; font-weight: bold; text-decoration: none; font-size: 0.85rem; }
        .separator { text-align: center; margin: 30px 0 20px 0; color: var(--separator-color); font-weight: bold; font-size: 0.95rem; position: relative; opacity: 0.8; }
        .separator::before, .separator::after { content: ''; display: inline-block; width: 50px; height: 1px; background: var(--separator-color); vertical-align: middle; margin: 0 10px; opacity: 0.5; }
    </style>
</head>
<body>

    <div class="floating-tracker">
        <div class="tracker-bubble"><span id="floatCount">0</span></div>
    </div>

    <div id="settingsModal" class="modal-overlay" onclick="closeSettings(event)">
        <div class="settings-container">
            <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            <div class="settings-row">
                <span>ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø¯Ø§ÙŠØ© Ø±Ù…Ø¶Ø§Ù†</span>
                <button class="external-btn" onclick="adjustStartDate()">ØªØºÙŠÙŠØ± (+1 ÙŠÙˆÙ…)</button>
            </div>
            <button class="complete-btn" onclick="closeSettings(null)">Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <header>
        <div class="header-icons">
            <button class="icon-btn" id="themeBtn" onclick="toggleTheme()">ğŸŒ™</button>
            <button class="icon-btn" onclick="openSettings()">âš™ï¸</button>
        </div>
        <h1 class="header-title">Ø±ÙÙŠÙ‚ Ø§Ù„Ù‚Ø±Ø¢Ù† ğŸŒ™</h1>
        <div class="datetime" id="clock">...</div>
    </header>

    <div class="container">
        <div class="summary-box">
            <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø§ Ù‚Ø±Ø£Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>
            <div class="summary-number" id="mainTotal">0</div>
            <div class="summary-label">ØµÙØ­Ø©</div>
            <div style="margin-top: 15px; font-size: 0.8rem; opacity: 0.7; border-top: 1px solid var(--border-color); padding-top: 10px;">
                (ÙƒÙ„ ÙŠÙˆÙ… 20 ØµÙØ­Ø© = Ø®ØªÙ…Ø© ÙƒØ§Ù…Ù„Ø©)
            </div>
        </div>
        <div id="daysContainer"></div>
    </div>

    <script>
        const DEFAULT_START_DATE = new Date(2026, 1, 18); 
        const DAYS_TOTAL = 30;
        const PRAYERS = [
            { id: 'fajr', name: 'Ø§Ù„ÙØ¬Ø±', pages: 4 },
            { id: 'dhuhr', name: 'Ø§Ù„Ø¸Ù‡Ø±', pages: 4 },
            { id: 'asr', name: 'Ø§Ù„Ø¹ØµØ±', pages: 4 },
            { id: 'maghrib', name: 'Ø§Ù„Ù…ØºØ±Ø¨', pages: 4 },
            { id: 'isha', name: 'Ø§Ù„Ø¹Ø´Ø§Ø¡', pages: 4 }
        ];

        let db = JSON.parse(localStorage.getItem('ramadan_db_v2')) || {};
        let dateOffset = parseInt(localStorage.getItem('date_offset')) || 0;
        
        // --- ğŸ”´ ØªØ«Ø¨ÙŠØª Ø§Ù„ÙˆØ²Ù†ÙŠØ© Ø¹Ù„Ù‰ 3 Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ---
        const PDF_OFFSET = 3; 

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        function updateClock() {
            const now = new Date();
            const dayName = now.toLocaleDateString('ar-SA', { weekday: 'long' });
            const dateStr = now.toLocaleDateString('ar-SA', { day: 'numeric', month: 'long', year: 'numeric' });
            const timeStr = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute:'2-digit' });
            document.getElementById('clock').innerText = `${dayName}ØŒ ${dateStr} | ${timeStr}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }
        function updateThemeIcon(theme) {
            document.getElementById('themeBtn').innerText = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function openSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
        }
        function closeSettings(e) {
            if (e === null || e.target.id === 'settingsModal' || e.target.classList.contains('complete-btn')) {
                document.getElementById('settingsModal').style.display = 'none';
                render(); 
            }
        }
        function adjustStartDate() {
            dateOffset = (dateOffset === 0) ? 1 : 0;
            localStorage.setItem('date_offset', dateOffset);
            alert("ØªÙ… ØªØºÙŠÙŠØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.");
        }
        function getRamadanStart() {
            const d = new Date(DEFAULT_START_DATE);
            d.setDate(d.getDate() + dateOffset);
            return d;
        }

        function render() {
            const container = document.getElementById('daysContainer');
            if (!container) return; // Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            container.innerHTML = '';
            
            let grandTotalPages = 0;
            const today = new Date();
            today.setHours(0,0,0,0);
            const ramadanStart = getRamadanStart();

            for (let i = 0; i < DAYS_TOTAL; i++) {
                if (i === 20) {
                    const sep = document.createElement('div');
                    sep.className = 'separator';
                    sep.innerText = 'Ø§Ù„Ø¹Ø´Ø± Ø§Ù„Ø£ÙˆØ§Ø®Ø±';
                    container.appendChild(sep);
                }

                let currentDate = new Date(ramadanStart);
                currentDate.setDate(ramadanStart.getDate() + i);
                currentDate.setHours(0,0,0,0);

                const dayId = `day_${i}`;
                const dayData = db[dayId] || {};
                
                let prayersDone = 0;
                let dayPages = 0;
                PRAYERS.forEach(p => {
                    if (dayData[p.id]) {
                        prayersDone++;
                        dayPages += p.pages;
                    }
                });
                grandTotalPages += dayPages;
                const isComplete = prayersDone === 5;

                let statusClass = '';
                const diffTime = today - currentDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 0) statusClass = 'current'; 
                else if (diffDays > 0 && !isComplete) {
                    if (diffDays === 1) statusClass = 'missed-yellow';
                    else statusClass = 'missed-red';
                }

                const card = document.createElement('div');
                card.className = `day-card ${statusClass}`;
                
                const header = document.createElement('div');
                header.className = 'card-header';
                const checkColor = isComplete ? '#27ae60' : 'var(--text-sub)';

                header.innerHTML = `
                    <div class="date-group">
                        <span class="day-name">${i + 1} Ø±Ù…Ø¶Ø§Ù† - ${getDayName(currentDate)}</span>
                        <span class="day-date">${formatDate(currentDate)}</span>
                    </div>
                    <div class="status-badge" style="color:${checkColor}">
                        ${isComplete ? 'âœ…' : `${prayersDone}/5`}
                    </div>
                `;

                const body = document.createElement('div');
                body.className = 'card-body';
                if (statusClass === 'current') body.classList.add('open');

                const list = document.createElement('div');
                list.className = 'prayer-list';

                PRAYERS.forEach((p, pIndex) => {
                    const pStartPage = (i * 20) + 1 + (pIndex * 4);
                    const pEndPage = pStartPage + 3;
                    
                    const row = document.createElement('div');
                    row.className = 'prayer-item';
                    
                    const chk = document.createElement('input');
                    chk.type = 'checkbox';
                    chk.className = 'custom-checkbox';
                    chk.checked = dayData[p.id] || false;
                    chk.onclick = () => togglePrayer(dayId, p.id, chk.checked);

                    const lbl = document.createElement('div');
                    lbl.className = 'prayer-label';
                    lbl.innerHTML = `<span>${p.name}</span><span class="page-range">ØµÙØ­Ø© ${pStartPage} - ${pEndPage}</span>`;
                    lbl.onclick = () => { chk.checked = !chk.checked; togglePrayer(dayId, p.id, chk.checked); };
                    lbl.style.cursor = 'pointer';

                    // --- Ø§Ù„ÙˆØ²Ù†ÙŠØ© +3 ---
                    const pdfPage = pStartPage + PDF_OFFSET; 
                    const pdfUrl = 'reader.html?page=' + pdfPage;
                    
                    const readLink = document.createElement('a');
                    readLink.className = 'read-btn';
                    readLink.innerHTML = 'ğŸ“–';
                    readLink.href = pdfUrl;
                    readLink.target = "_self"; 
                    readLink.onclick = (e) => e.stopPropagation();

                    row.appendChild(chk);
                    row.appendChild(lbl);
                    row.appendChild(readLink);
                    list.appendChild(row);
                });

                const btn = document.createElement('button');
                btn.className = `complete-btn ${isComplete ? 'done' : ''}`;
                btn.innerText = isComplete ? 'ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© (20 ØµÙØ­Ø©) âœ…' : `Ù‚Ø±Ø£Øª ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ… (${i+1} Ø±Ù…Ø¶Ø§Ù†)`;
                btn.onclick = () => completeDay(dayId);

                body.appendChild(list);
                body.appendChild(btn);

                header.onclick = () => {
                    const isOpen = body.classList.contains('open');
                    if(!isOpen) body.classList.add('open');
                    else body.classList.remove('open');
                };

                card.appendChild(header);
                card.appendChild(body);
                container.appendChild(card);
            }

            document.getElementById('mainTotal').innerText = grandTotalPages;
            document.getElementById('floatCount').innerText = grandTotalPages;
        }

        const getDayName = (date) => date.toLocaleDateString('ar-SA', { weekday: 'long' });
        const formatDate = (date) => `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;

        function togglePrayer(dayId, prayerId, state) {
            if (!db[dayId]) db[dayId] = {};
            db[dayId][prayerId] = state;
            save();
        }
        function completeDay(dayId) {
            if (!db[dayId]) db[dayId] = {};
            PRAYERS.forEach(p => db[dayId][p.id] = true);
            save();
        }
        function save() {
            localStorage.setItem('ramadan_db_v2', JSON.stringify(db));
            render();
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        render();
    </script>
</body>
</html>